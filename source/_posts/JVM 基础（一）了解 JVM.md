---
title: JVM 基础（一）了解 JVM
date: 2024-08-24
comments: true
comments: true
category: JVM
tags:
  - 阅读
cover: https://tse2-mm.cn.bing.net/th/id/OIP-C.iK1EFamgj6pjOvuhROEFNAHaEK?w=305&h=180&c=7&r=0&o=5&dpr=1.3&pid=1.7
---





# JVM 基础（一）了解 JVM

**字节码文件：**使用 `javac` 命令编译 **Java 源代码文件**后生成的文件，里面包含**字节码指令**，字节码文件是一种中间代码，不能被计算机直接执行，通过 **JVM** 的**解释器**解释成机器码，解释后的机器码能被计算机直接执行。

对源代码进行编译（javac）之后拿到的是字节码，字节码不是机器语言（即不能被机器识别，被机器直接运行），想要其被机器识别就要将其解释成能被机器识别的代码（如机器码等），怎么实现这一步呢？交给一个现有的程序来实现这种转换吧！不同的操作系统（Windows、Mac、Linux）有配上了不同的程序，这样使同一份字节码文件能被不同平台的 JVM 解释，这下跨平台实现啦！

**JVM** 全称是 Java Virtual Machine，中文译名 Java虚拟机。JVM 本质上是一个运行在计算机上的程序，他的职责是**加载并运行 Java 字节码文件**。

> 对象的创建需要类的信息，JVM 将磁盘、网络或其他来源中的字节码文件加载到内存中，生成一个 Class 对象，通过 Class 对象在来获取这些信息来创建对象。
>
> - 字节码通过**类加载器**被加载到 JVM 内存中；
>   - 启动（Bootstrap）类加载器：负责加载 Java 核心类库；
>   - 扩展（Extension）类加载器：负责加载 Java 扩展类库；（之后叫做平台Platform类加载器）；
>   - 应用程序（Application）类加载器：负责加载应用程序类路径（classpath）下的类。
> - 在内存中的**方法区**（Method Area）中生成一个 Class 对象，包含类的所有的信息，如方法、字段、构造函数等信息，用来创建对象；
> - 创建对象的时候，需要通过**执行引擎**来执行代码（JIT、解释器、垃圾回收器）；
>   - 解释器：逐条解释并执行字节码指令；
>   - JIT 编译器：将热点代码（频繁执行的代码）编译成本地机器码，以提高执行效率
>   - 垃圾回收器：自动管理内存，回收不再使用的对象占用的内存空间
> - Java 中的某些方法（被 native 修饰的方法）可能需要调用底层的 C/C++ 代码来实现特定的功能，这些方法被称为本地方法（Native Method）。
>   - 本地方法通过 **JNI**（Java Native Interface） 调用 C/C++ 代码实现功能（允许 Java 代码调用 C/C++ 代码）



**Java 性能低的主要原因：**JVM 需要将字节码指令实时地解释（逐行解释）成计算机能够识别地机器码，这个过程在运行时可能会反复执行。

**Java 跨平台：**Java 的字节码指令能够在不同的平台上运行是因为 JVM 的存在。同一份字节码指令运行在不同平台的 JVM 上可以解释成不同的机器码。



## 1. JVM 详解

### 1. JVM 的功能

> 将 Java 源代码编译后的字节码文件加载到内存中解释并运行，自动为对象分配内存，回收不再使用的对象（垃圾），对于热点代码进行即时编译，提高运行速度。

- **解释和运行：**将字节码文件中的字节码指令实时地解释成机器码，使计算机可以运行。
- **内存管理：**
  - 自动为对象、方法分配内存
  - 自动的而垃圾回收机制，回收不再使用的对象
- **即时编译：**对热点代码（被非常高频调用）进行优化，提升效率。（即时编译器会优化这段代码并将优化后的机器码保存在内存中，这样在第二次执行这段代码时，直接在内存中取出来直接进行调用。可以节省解释的步骤，同时执行的时优化后的代码，效率较高，性能geng）

### 2. JVM 的组成

![JVM 的组成](https://web-tlias-mmh.oss-cn-beijing.aliyuncs.com/img/899262d1-c730-4fd1-ab34-f95bf0500b99.png)

> 需要将字节码文件加载（使用类加载器）到内存中，之后为其分配空间（这里叫做运行时数据区域），之后便由执行引擎来执行相关的指令

- **类加载器：**负责将`字节码文件`从网络或磁盘等位置加载到内存中
- **运行时数据区：**JVM 管理的`内存`，存放创建出的对象，类的信息等等内容
- **执行引擎：**包含了**即时编译器**、**解释器**、**垃圾回收器**，执行引擎功能如下：
  - 使用解释器将字节码指令解释成机器码，
  - 使用即时编译器将字节码转换成机器码之后执行，提高性能；
  - 使用垃圾回收器回收不再使用的对象，自动管理内存释放避免内存泄漏。
- 本地接口：调用本地使用 C/C++ 编译好的方法，本地方法在 Java中声明时，都会加上 `native` 关键字。



### 3. 常见 JVM

平时最常用的是 Hotspot 虚拟机

| 名称                       | 作者    | 支持版本                  | 社区活跃度（github star） | 特性                                                         | 适用场景                             |
| -------------------------- | ------- | ------------------------- | ------------------------- | ------------------------------------------------------------ | ------------------------------------ |
| HotSpot (Oracle JDK版)     | Oracle  | 所有版本                  | 高(闭源)                  | 使用最广泛，稳定可靠，社区活跃JIT支持Oracle JDK默认虚拟机    | 默认                                 |
| HotSpot (Open JDK版)       | Oracle  | 所有版本                  | 中(16.1k)                 | 同上开源，Open JDK默认虚拟机                                 | 默认对JDK有二次开发需求              |
| GraalVM                    | Oracle  | 11, 17,19企业版支持8      | 高（18.7k）               | 多语言支持高性能、JIT、AOT支持                               | 微服务、云原生架构需要多语言混合编程 |
| Dragonwell JDK龙井         | Alibaba | 标准版 8,11,17扩展版11,17 | 低(3.9k)                  | 基于OpenJDK的增强高性能、bug修复、安全性提升JWarmup、ElasticHeap、Wisp特性支持 | 电商、物流、金融领域对性能要求比较高 |
| Eclipse OpenJ9 (原 IBM J9) | IBM     | 8,11,17,19,20             | 低(3.1k)                  | 高性能、可扩展JIT、AOT特性支持                               | 微服务、云原生架构                   |
